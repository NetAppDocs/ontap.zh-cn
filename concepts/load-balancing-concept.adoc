---
permalink: concepts/load-balancing-concept.html 
sidebar: sidebar 
keywords: 'load balance, workload, latency, overload, reduce load, ceiling, limits, iops, "mb/s", qos, min, max, policy group, throughput, headroom, floor, adaptive qos' 
summary: 当节点上的工作量超过可用资源时，工作负载的性能开始受到延迟的影响。您可以通过增加可用资源（升级磁盘或 CPU ）或减少负载（根据需要将卷或 LUN 移动到不同节点）来管理过载节点。 
---
= 负载平衡
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
当节点上的工作量超过可用资源时，工作负载的性能开始受到延迟的影响。您可以通过增加可用资源（升级磁盘或 CPU ）或减少负载（根据需要将卷或 LUN 移动到不同节点）来管理过载节点。

您还可以使用 ONTAP _storage Quality of Service （ QoS ） _ 来保证关键工作负载的性能不会因争用工作负载而降级：

* 您可以为争用资源的工作负载设置 QoS 吞吐量上限，以限制其对系统资源的影响（ QoS 最大值）。
* 您可以为关键工作负载设置 QoS 吞吐量 _floor_ ，以确保其满足最小吞吐量目标，而不管争用工作负载的需求如何（ QoS 最小值）。
* 您可以为同一工作负载设置 QoS 上限和下限。




== 吞吐量上限

吞吐量上限会将工作负载的吞吐量限制为最大 IOPS 数或 MB/ 秒在下图中，工作负载 2 的吞吐量上限可确保它不会 "`抢占` " 工作负载 1 和 3 。

策略组定义了一个或多个工作负载的吞吐量上限。工作负载表示 _storage 对象： _ 卷，文件或 LUN 或 SVM 中的所有卷，文件或 LUN 的 I/O 操作。您可以在创建策略组时指定上限，也可以等到监控工作负载之后再指定上限。

[NOTE]
====
工作负载的吞吐量可能会超出指定上限 10% ，尤其是在工作负载的吞吐量发生快速变化时。要处理突发事件，上限可能会超过 50% 。

====
image:qos-ceiling-concepts.gif["吞吐量上限"]



== 吞吐量下限

吞吐量下限可确保工作负载的吞吐量不会低于最小 IOPS 数。在下图中，工作负载 1 和工作负载 3 的吞吐量下限可确保满足最小吞吐量目标，而不管工作负载 2 的需求如何。

[TIP]
====
如示例所示，吞吐量上限会直接限制吞吐量。吞吐量下限会优先考虑设置了下限的工作负载，从而间接限制吞吐量。

====
工作负载表示卷， LUN 或从 ONTAP 9.3 开始的文件的 I/O 操作。定义吞吐量下限的策略组不能应用于 SVM 。您可以在创建策略组时指定下限，也可以等到监控工作负载之后再指定下限。

[NOTE]
====
如果节点或聚合上的性能容量(余量)不足、或者在执行等关键操作期间、工作负载的吞吐量可能会低于指定的下限 `volume move trigger-cutover`。即使有足够的可用容量且未执行关键操作，工作负载的吞吐量也可能会低于指定的下限，最高可达 5% 。

====
image:qos-floor-concepts.gif["吞吐量下限"]



== 自适应 QoS

通常，分配给存储对象的策略组值是固定的。当存储对象的大小发生变化时，您需要手动更改此值。例如，增加卷上的已用空间量通常需要相应地增加为卷指定的吞吐量上限。

_Adaptive QoS_ 会自动将策略组值扩展到工作负载大小，并在工作负载大小发生变化时保持 IOPS 与 TBSGB 的比率。如果您要在大型部署中管理数百或数千个工作负载，则这是一项显著优势。

通常，您可以使用自适应 QoS 来调整吞吐量上限，但也可以使用它来管理吞吐量下限（当工作负载大小增加时）。工作负载大小表示为存储对象分配的空间或存储对象使用的空间。


NOTE: 在 ONTAP 9.5 及更高版本中，已用空间可用于吞吐量下限。在 ONTAP 9.4 及更早版本中，吞吐量下限不支持此功能。

+
从ONTAP 9.13.1开始、您可以使用自适应QoS在SVM级别设置吞吐量下限和上限。

* 已分配空间策略会根据存储对象的标称大小保持 IOPS/TBGB 比率。如果此比率为 100 IOPS/GB ，则只要 150 GB 卷保持此大小，其吞吐量上限将为 15 ， 000 IOPS 。如果将卷大小调整为 300 GB ，则自适应 QoS 会将吞吐量上限调整为 30 ， 000 IOPS 。
* 已用空间策略（默认值）会根据存储效率之前存储的实际数据量保持 IOPS/TBGB 比率。如果此比率为 100 IOPS/GB ，则存储了 100 GB 数据的 150 GB 卷的吞吐量上限为 10 ， 000 IOPS 。随着已用空间量的变化，自适应 QoS 会根据比率调整吞吐量上限。


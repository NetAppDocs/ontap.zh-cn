---
permalink: tape-backup/dump-backup-concept.html 
sidebar: sidebar 
keywords: dump, backup, qtree, file, system, data 
summary: 转储备份会使用预定义的过程将文件系统数据从磁盘写入磁带。您可以备份既不是整个卷也不是整个 qtree 的卷， qtree 或子树。 
---
= 转储备份如何与ONTAP NDMP 配合使用
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
转储备份会使用预定义的过程将文件系统数据从磁盘写入磁带。您可以备份既不是整个卷也不是整个 qtree 的卷， qtree 或子树。

下表介绍了 ONTAP 用于备份转储路径指示的对象的过程：

[cols="1,4"]
|===
| 阶段 | Action 


 a| 
1.
 a| 
对于容量不足或容量不足的 qtree 备份， ONTAP 会遍历目录以确定要备份的文件。如果要备份整个卷或 qtree ， ONTAP 会将此阶段与阶段 2 结合使用。



 a| 
2.
 a| 
对于完整卷或完整 qtree 备份， ONTAP 会标识要备份的卷或 qtree 中的目录。



 a| 
3.
 a| 
ONTAP 会将目录写入磁带。



 a| 
4.
 a| 
ONTAP 会将这些文件写入磁带。



 a| 
5.
 a| 
ONTAP 会将 ACL 信息（如果适用）写入磁带。

|===
转储备份使用数据快照进行备份。因此，您不必在启动备份之前将卷脱机。

转储备份将其创建的每个快照命名为 `snapshot_for_backup.n`，其中 `n`是一个从0开始的整数。每次创建快照时、转储备份都会将整数加1。重新启动存储系统后，此整数将重置为 0 。备份操作完成后、转储引擎将删除此快照。

当ONTAP同时执行多个转储备份时、转储引擎会创建多个快照。例如，如果ONTAP同时运行两个转储备份，则可以在要从中备份数据的卷中找到以下快照： `snapshot_for_backup.0`和 `snapshot_for_backup.1`。

[NOTE]
====
从快照备份时、转储引擎不会创建其他快照。

====


== 转储引擎备份的数据类型

通过转储引擎，您可以将数据备份到磁带，以防止发生灾难或控制器中断。除了备份文件，目录， qtree 或整个卷等数据对象之外，转储引擎还可以备份有关每个文件的多种类型的信息。了解转储引擎可以备份的数据类型以及要考虑的限制有助于您规划灾难恢复方法。

除了备份文件中的数据之外，转储引擎还可以根据需要备份有关每个文件的以下信息：

* UNIX GID ，所有者 UID 和文件权限
* UNIX 访问，创建和修改时间
* 文件类型
* 文件大小
* DOS 名称， DOS 属性和创建时间
* 包含 1 ， 024 个访问控制条目（ ACE ）的访问控制列表（ ACL ）
* qtree 信息
* 接合路径


接合路径将备份为符号链接。

* LUN 和 LUN 克隆
+
您可以备份整个 LUN 对象，但不能备份 LUN 对象中的单个文件。同样，您可以还原整个 LUN 对象，但不能还原 LUN 中的单个文件。

+
[NOTE]
====
转储引擎将 LUN 克隆备份为独立的 LUN 。

====
* VM-aligned 文件
+
Data ONTAP 8.1.2 之前的版本不支持备份与 VM 对齐的文件。



[NOTE]
====
当 Snapshot 支持的 LUN 克隆从 7- 模式 Data ONTAP 过渡到 ONTAP 时，它将成为不一致的 LUN 。转储引擎不会备份不一致的 LUN 。

====
将数据还原到卷时，将限制要还原的 LUN 上的客户端 I/O 。只有在转储还原操作完成后，才会删除 LUN 限制。同样，在 SnapMirror 单个文件或 LUN 还原操作期间，客户端 I/O 会同时受限于要还原的文件和 LUN 。只有在单个文件或 LUN 还原操作完成后，才会删除此限制。如果对正在执行转储还原或 SnapMirror 单个文件或 LUN 还原操作的卷执行转储备份，则具有客户端 I/O 限制的文件或 LUN 不会包含在备份中。如果删除了客户端 I/O 限制，这些文件或 LUN 将包含在后续备份操作中。

[NOTE]
====
在 Data ONTAP 8.3 上运行并备份到磁带的 LUN 只能还原到 8.3 及更高版本，而不能还原到早期版本。如果将 LUN 还原到早期版本，则 LUN 将还原为文件。

====
将 SnapVault 二级卷或卷 SnapMirror 目标备份到磁带时，只会备份卷上的数据。不会备份关联的元数据。因此，在尝试还原卷时，只会还原该卷上的数据。有关卷 SnapMirror 关系的信息在备份中不可用，因此不会还原。

如果转储一个仅具有 Windows NT 权限的文件并将其还原到 UNIX 模式的 qtree 或卷，则该文件将获得该 qtree 或卷的默认 UNIX 权限。

如果转储一个仅具有 UNIX 权限的文件并将其还原到 NTFS 模式的 qtree 或卷，则该文件将获得该 qtree 或卷的默认 Windows 权限。

其他转储和还原操作会保留权限。

您可以备份与VM对齐的文件和 `vm-align-sector` 选项有关 VM 对齐文件的详细信息，请参见 link:../volumes/index.html["逻辑存储管理"]。

---
permalink: svm-migrate/index.html 
sidebar: sidebar 
keywords: svm, migrate, workflow, relocate, prerequisites, data mobility 
summary: 从ONTAP 9.10.1 开始，集群管理员可以无中断地将 SVM 从源集群迁移到目标集群，以管理容量和负载均衡，或启用设备升级或数据中心整合。从ONTAP 9.12.1 开始， FAS和AFF系统以及混合聚合体均支持此功能。 
---
= 了解ONTAP SVM 数据迁移
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
从ONTAP 9.10.1 开始，集群管理员可以无中断地将 SVM 从源集群迁移到目标集群，以管理容量和负载均衡，或启用设备升级或数据中心整合。

ONTAP 9.10.1 和 9.11.1 版本支持在AFF系统上进行非中断式 SVM 迁移。从ONTAP 9.12.1 开始， FAS和AFF系统以及混合聚合体均支持此功能。

迁移后， SVM 的名称和 UUID 以及数据 LIF 名称， IP 地址和对象名称（例如卷名称）均保持不变。SVM 中对象的 UUID 将不同。

从ONTAP 9.18.1 开始，支持从ASA存储系统到ASA r2 存储系统的 SVM 迁移。如果您拥有ASA r2 存储系统（ASA A1K、 ASA A90、 ASA A70、 ASA A50、 ASA A30、 ASA A20 或ASA C30），并且想要将 SVM 从ASA系统迁移到您的ASA r2 系统，请按以下步骤操作。link:https://docs.netapp.com/us-en/asa-r2/manage-data/migrate-svm.html["这些步骤"^] 。



== SVM 迁移工作流

此图显示了 SVM 迁移的典型工作流。从目标集群开始 SVM 迁移。您可以从源或目标监控迁移。您可以执行手动转换或自动转换。默认情况下会执行自动转换。

image:workflow_svm_migrate.gif["SVM迁移工作流。下面总结了接下来的步骤。"]



== SVM迁移系统支持

[cols="1,1"]
|===


| 控制器系列 | 支持的ONTAP版本 


| ASA | ONTAP 9.18.1 及更高版本 关注link:https://docs.netapp.com/us-en/asa-r2/manage-data/migrate-svm.html["这些步骤"^]用于将 SVM 从ASA迁移到ASA r2 系统。 


| AFF C系列 | ONTAP 9.12.1修补程序4及更高版本 


| FAS | ONTAP 9.12.1及更高版本 


| AFF A系列 | ONTAP 9.10.1 及更高版本 
|===

NOTE: 从AFF集群迁移到具有混合聚合的FAS集群时，自动卷放置会尝试执行类似的聚合匹配。例如，如果源集群有 60 个卷，则卷放置操作会尝试在目标集群上找到一个AFF聚合来放置这些卷。当AFF聚合空间不足时，卷将被放置在具有非闪存磁盘的聚合上。



== ONTAP版本的可扩展性支持

[cols="1,1"]
|===


| ONTAP 版本 | 源和目标中的HA对 


| ONTAP 9.14.1及更高版本 | 12. 


| ONTAP 9.13.1 | 6. 


| ONTAP 9.11.1 | 3. 


| ONTAP 9.10.1 | 1. 
|===


== 源集群与目标集群之间TCP往返时间(RTT)的网络基础架构性能要求

根据集群上安装的ONTAP版本、连接源集群和目标集群的网络必须具有所示的最长往返时间：

|===


| ONTAP 版本 | 最大RTT 


| ONTAP 9.12.1及更高版本 | 10毫秒 


| ONTAP 9.11.1及更早版本 | 2毫秒 
|===


== 每个SVM支持的最大卷数

[cols="1,1,1,1,1,1"]
|===


| 源 | 目标 | ONTAP 9.14.1及更高版本 | ONTAP 9.13.1 | ONTAP 9.12.1 | ONTAP 9.11.1及更早版本 


| AFF | AFF | 400 | 200 | 100 | 100 


| FAS | FAS | 80 | 80 | 80 | 不适用 


| FAS | AFF | 80 | 80 | 80 | 不适用 


| AFF | FAS | 80 | 80 | 80 | 不适用 
|===


== 前提条件

在启动SVM迁移之前、您必须满足以下前提条件：

* 您是集群管理员。
* link:../peering/create-cluster-relationship-93-later-task.html["源集群和目标集群彼此互联"]。
* 源集群和目标集群具有同步的SnapMirror 。 link:../system-admin/install-license-task.html["已安装许可证"]。此许可证包含在内 link:../system-admin/manage-licenses-concept.html#licenses-included-with-ontap-one["ONTAP One"]。
* 源集群中的所有节点均运行ONTAP 9.10.1 或更高版本。有关ONTAP阵列控制器的具体支持，请参阅 link:https://hwu.netapp.com/["Hardware Universe"^]。
* 源集群中的所有节点都运行相同的ONTAP版本。
* 目标集群中的所有节点都运行相同的ONTAP版本。
* 目标集群的ONTAP版本与源集群的 ONTAP 版本相同，或者最多比源集群的新两个主要版本。
* 源集群和目标集群支持相同的 IP 子网以进行数据 LIF 访问。
* 源SVM包含的数量少于 xref:Maximum supported volumes per SVM[此版本支持的最大数据卷数]。
* 目的地有足够的空间放置书籍。
* 如果源 SVM 具有加密卷，则需要在目标集群级别配置板载密钥管理器或外部密钥管理。
+
** 在这种情况下，在源端 SVM 级别配置的密钥管理器不会迁移到目标端。目标位置使用集群级密钥管理器。


* 如果源具有加密卷并且配置了NetApp聚合加密 (NAE)，则目标也必须配置为 NAE。
* 如果要在非MetroCluster配置和MetroCluster配置之间或两个MetroCluster配置之间迁移SVM、请验证您的配置是否满足以下要求：
+

NOTE: 在MetroCluster配置中，不支持在本地集群和伙伴集群之间迁移 SVM。

+
** 源和目标MetroCluster集群处于"正常"状态。这意味着它们不能处于切换模式或"正在等待切回"状态。
** 源和目标MetroCluster集群未处于FC-IP过渡或硬件更新过程中。
** 源集群和目标集群必须都运行ONTAP 9.16.1 或更高版本。
** 如果源为MetroCluster集群、则SVM子类型为"sync-ssource"(而不是"sync-Destination ")。
+

NOTE: 如果目标是MetroCluster集群、则在目标上创建的SVM始终为"sync-ssource"。如果目标为非MetroCluster集群、则SVM子类型始终为"default"。







== 最佳实践

执行SVM迁移时、最佳做法是在源集群和目标集群上保留30%的CPU性能余量、以便能够执行CPU工作负载。



== SVM操作

检查是否存在可能与 SVM 迁移冲突的操作：

* 未执行任何故障转移操作
* WAFLIRON 无法运行
* 指纹未在进行中
* 流量移动、重新托管、克隆、创建、转换或分析功能未运行
* 目标集群上没有运行SVM迁移程序。任何时候都只允许进行一次SVM迁移。




== 支持和不支持的功能

下表列出了SVM数据移动性支持的ONTAP功能以及提供支持的ONTAP版本。

有关SVM迁移中源和目标之间的ONTAP版本互操作性的信息、请参见 link:../data-protection/compatible-ontap-versions-snapmirror-concept.html#snapmirror-svm-disaster-recovery-relationships["SnapMirror 关系的兼容 ONTAP 版本"]。

[cols="3,1,4"]
|===


| 功能 | 支持先发布 | 注释 


| 自主勒索软件保护 | ONTAP 9.12.1 |  


| Cloud Volumes ONTAP | 不支持 |  


| 外部密钥管理器 | ONTAP 9.11.1 |  


| FabricPool | 不支持 |  


| 扇出关系(迁移源的SnapMirror源卷具有多个目标) | ONTAP 9.11.1 |  


| FC SAN | 不支持 |  


| Flash Pool | ONTAP 9.12.1 |  


| FlexCache 卷 | 不支持 |  


| FlexGroup 卷 | 不支持 |  


| IPsec策略 | 不支持 |  


| IPv6 LIF | 不支持 |  


| iSCSI SAN | 不支持 |  


| 作业计划复制 | ONTAP 9.11.1 | 在ONTAP 9.10.1中、迁移期间不会复制作业计划、必须在目标上手动创建作业计划。从ONTAP 9.11.1开始、源使用的作业计划会在迁移期间自动复制。 


| 负载共享镜像 | 不支持 |  


| MetroCluster SVM | ONTAP 9.16.1.  a| 
从ONTAP 9.161开始、支持以下MetroCluster SVM迁移：

* 在非MetroCluster配置和MetroCluster IP配置之间迁移SVM
* 在两个MetroCluster IP配置之间迁移SVM
* 在MetroCluster FC配置和MetroCluster IP配置之间迁移SVM


注意：源集群和目标集群必须都运行ONTAP 9.16.1 或更高版本才能支持 SVM 迁移。

并非所有ONTAP版本都支持以下MetroCluster SVM迁移：

* 在两个MetroCluster FC配置之间迁移SVM
* 在非MetroCluster配置和MetroCluster FC配置之间迁移SVM
* 在相同的MetroCluster配置中，将 SVM 从本地集群迁移到伙伴集群。


查看<<前提条件,前提条件>>在MetroCluster配置中迁移 SVM。



| NetApp 聚合加密（ NAE ） | ONTAP 9.11.1 | NAE 卷必须放置在 NAE 支持的目标位置。如果没有可用的 NAE 目标，则迁移操作失败。 


| NDMP配置 | 不支持 |  


| NetApp 卷加密（ NVE ） | ONTAP 9.10.1 | NVE 卷将作为 NVE 卷迁移到目标位置。 


| NFS和SMB审核日志 | ONTAP 9.13.1  a| 
[NOTE]
====
对于启用了审核的内部SVM迁移、您应在源SVM上禁用审核、然后执行迁移。

====
迁移SVM之前：

* link:../nas-audit/enable-disable-auditing-svms-task.html["必须在目标集群上启用审核日志重定向"]。
* link:../nas-audit/commands-modify-auditing-config-reference.html?q=audit+log+destination+path["必须在目标集群上创建源SVM的审核日志目标路径"]。




| NFS v3、NFS v4.1和NFS v4.2 | ONTAP 9.10.1 |  


| NFS v4.0 | ONTAP 9.12.1 |  


| 使用pNFS的NFSv4.1 | ONTAP 9.14.1 |  


| 基于网络结构的NVMe | 不支持 |  


| 在源集群上启用了通用标准模式的板载密钥管理器(OKM) | 不支持 |  


| qtree | ONTAP 9.14.1 |  


| 配额 | ONTAP 9.14.1 |  


| S3 | 不支持 |  


| SMB协议 | ONTAP 9.12.1  a| 
中小企业迁移会造成混乱，迁移后需要对客户端进行更新。



| SnapMirror云关系 | ONTAP 9.12.1 | 从SVM.12.1开始、在迁移具有SnapMirror云关系的内部ONTAP 9时、目标集群必须已link:../data-protection/snapmirror-licensing-concept.html#snapmirror-cloud-license["SnapMirror云许可证"]安装、并且必须具有足够的可用容量、以支持将要镜像到云的卷中的容量移动。 


| SnapMirror异步目标 | ONTAP 9.12.1 |  


| SnapMirror异步源 | ONTAP 9.11.1  a| 
* 在大多数迁移过程中、FlexVol SnapMirror关系上的传输可以继续正常进行。
* 切换期间，所有正在进行的转账都会被取消，新的转账也会失败。迁移完成之前，它们无法重新启动。
* 迁移期间取消或错过的计划传输不会在迁移完成后自动启动。
+
[NOTE]
====
迁移SnapMirror源后、ONTAP不会阻止在迁移后删除卷、直到进行SnapMirror更新。之所以出现这种情况、是因为只有在迁移完成后以及首次更新之后、才会提供与迁移的SnapMirror源卷相关的SnapMirror信息。

====




| SMTape设置 | 不支持 |  


| SnapLock | 不支持 |  


| SnapMirror活动同步 | 不支持 |  


| SnapMirror SVM对等关系 | ONTAP 9.12.1 |  


| SnapMirror SVM灾难恢复 | 不支持 |  


| SnapMirror同步 | 不支持 |  


| 快照 | ONTAP 9.10.1 |  


| 防篡改快照锁定 | ONTAP 9.14.1 | 防篡改快照锁定与SnapLock不等效。SnapLock Enterprise和SnapLock Compliance仍不受支持。 


| 虚拟IP Cifs/BGP | 不支持 |  


| Virtual Storage Console 7.0及更高版本 | 不支持 |  


| 卷克隆 | 不支持 |  


| vStorage | 不支持 | 启用vStorage后、不允许迁移。要执行迁移、请禁用vStorage选项、然后在迁移完成后重新启用它。 
|===


== 迁移期间支持的操作

下表根据迁移状态显示了正在迁移的SVM中支持的卷操作：

[cols="2,1,1,1"]
|===


| 卷操作 3+| SVM迁移状态 


|  | 正在进行 * | *已暂停* | * 转换 * 


| 创建 | 不允许 | 允许 | 不支持 


| 删除 | 不允许 | 允许 | 不支持 


| 禁用文件系统分析 | 允许 | 允许 | 不支持 


| 启用文件系统分析 | 不允许 | 允许 | 不支持 


| 修改 | 允许 | 允许 | 不支持 


| 脱机/联机 | 不允许 | 允许 | 不支持 


| 移动/重新托管 | 不允许 | 允许 | 不支持 


| qtree创建/修改 | 不允许 | 允许 | 不支持 


| 配额创建/修改 | 不允许 | 允许 | 不支持 


| 重命名 | 不允许 | 允许 | 不支持 


| 调整大小 | 允许 | 允许 | 不支持 


| 限制 | 不允许 | 允许 | 不支持 


| Snapshot属性已修改 | 允许 | 允许 | 不支持 


| Snapshot自动删除修改 | 允许 | 允许 | 不支持 


| Snapshot创建 | 允许 | 允许 | 不支持 


| Snapshot删除 | 允许 | 允许 | 不支持 


| 从快照还原文件 | 允许 | 允许 | 不支持 
|===
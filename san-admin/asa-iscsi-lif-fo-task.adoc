---
permalink: san-admin/asa-iscsi-lif-fo-task.html 
sidebar: sidebar 
keywords: failover, iscsi, all san array, cli, system manager, auto-revert, revert network interface 
summary: iSCSI LIF故障转移功能可从所有SAN阵列平台上的ONTAP 9.11.1获得、并允许iSCSI LIF在主节点发生故障之前从故障节点迁移到其HA配对节点。 
---
= 适用于ASA 平台的iSCSI LIF故障转移
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
iSCSI逻辑接口(LIF)故障转移功能可从全SAN阵列(All SAN Array、ASA)平台上的ONTAP 9.11.1中使用、并允许iSCSI LIF在主节点发生故障之前从故障节点迁移到其HA配对节点。只有当整个ONTAP 集群使用ONTAP 9.11.1或更高版本时、才能启用iSCSI LIF故障转移功能。

以下列表介绍了此功能的工作原理：

* 对于使用`data-iscsi`服务策略的LIF、failover-policy限制为`sfo-partner-only`、`local-only`和`disenabled`
* iSCSI LIF的故障转移策略设置为`sfo-partner-only`时、只能故障转移到HA配对节点
* 如果交还策略设置为`auto-revert true`且节点恢复仲裁、则会发生交还
* 如果发生计划内或计划外节点接管、则接管节点上的iSCSI LIF将故障转移到HA配对节点；LIF故障转移所用的端口由VIF管理器确定
* 故障转移完成后、iSCSI LIF将正常运行
* 启动交还后、iSCSI LIF将恢复到其主节点和端口




== System Manager 操作步骤

从ONTAP 9.11.1开始、您可以使用System Manager从ASA 平台迁移iSCSI LIF、该平台将在主节点发生故障之前迁移到其HA配对节点。默认情况下、ASA 平台会启用迁移和还原功能。



=== 故障转移

.步骤
. 在System Manager中、单击*网络>概述>网络接口*
. 选择要迁移的LIF、然后单击 image:icon_kabob.gif["kabob 图标"]、然后单击*迁移*。
. 在*迁移接口*对话框中、选择HA配对节点的目标节点和端口。
. 单击 * 迁移 * 。




=== 交还

.步骤
. 在System Manager中、单击*网络>概述>网络接口*。
. 选择要还原的LIF、然后单击 image:icon_kabob.gif["kabob 图标"] 然后单击*还原网络接口*。
. 在*还原网络接口*对话框中、单击*还原*。




== 命令行界面操作步骤

从ONTAP 9.11.1开始、在ASA 平台上使用以下命令创建和管理iSCSI LIF。默认情况下、已启用故障转移和自动还原功能。_

|===


| 如果您要 ... | 使用此命令 ... 


| 创建iSCSI LIF | `network interface create -vserver _svm_name_-lif _iscsi_lif_-service-policy default-data-blocks -data-protocol iscsi -home-node _node_name_-home-port _port_name_` 


| 验证是否已成功创建LIF | `network interface show -vserver _svm_name_-fields failover-policy、failover-group、auto-revert、is-home` 


| 验证是否可以覆盖iSCSI LIF上的自动还原默认值 | `network interface modify -vserver _svm_name_-lif iscsi_lif -auto-revert false`您将收到错误：`Error：command failed：auto-revert cannot be disabled on SAN LIFs.` 


| 对iSCSI LIF执行存储故障转移 | `storage failover takeover -ofnode _node_name_-option normal`您将收到警告：`将启动接管。配对节点重新启动后、系统将自动启动交还。是否要继续？｛y/n｝：` a `y`响应将显示其HA配对节点的接管消息。 
|===
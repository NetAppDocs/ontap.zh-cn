---
permalink: san-admin/enable-space-allocation-scsi-thin-provisioned-luns-task.html 
sidebar: sidebar 
keywords: enable, space, allocation, scsi, thinly, provisioned luns 
summary: 如果将 space-allocation 选项设置为 enabled ，则当卷空间用尽且卷中的 LUN 无法接受写入时， ONTAP 会通知主机。此选项还允许 ONTAP 在主机删除数据时自动回收空间。 
---
= 为 SCSI 精简配置 LUN 启用空间分配
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果主机支持SCSI精简配置、则可以在ONTAP中为SCSI精简配置LUN启用空间分配。  启用空间分配后、如果卷空间已用尽且卷中的LUN无法接受写入、则ONTAP会通知主机。此外、当主机删除数据时、ONTAP还会自动恢复空间。

在不支持 SCSI 精简配置的主机上，如果包含 LUN 的卷用尽空间且无法自动增长，则 ONTAP 会使 LUN 脱机。在支持SCSI精简配置的主机上、ONTAP不会在LUN用尽空间时将其脱机。LUN 在只读模式下保持联机，并且主机会收到 LUN 无法再接受写入的通知。

此外、在支持SCSI精简配置的主机上删除数据时、主机端空间管理会识别主机文件系统上已删除数据的块、并自动发出一个或多个 `SCSI UNMAP` 用于释放存储系统上相应块的命令。

.开始之前
要启用空间分配、主机必须支持SCSI精简配置。SCSI精简配置使用SCSI SBC-3标准中定义的逻辑块配置。只有支持此标准的主机才能在 ONTAP 中使用 SCSI 精简配置。

启用空间分配时，以下主机当前支持 SCSI 精简配置：

* Citrix XenServer 6.5及更高版本
* ESXi 5.0及更高版本
* Oracle Linux 6.2 UEK内核或更高版本
* RHEL 6.2及更高版本
* SLES11及更高版本
* Solaris 11.1及更高版本
* Windows


.关于此任务
默认情况下、所有LUN的空间分配均处于禁用状态。要启用空间分配、必须使LUN脱机；然后、必须在主机上执行发现、主机才能识别已启用空间分配。

.步骤
. 使LUN脱机。
+
[source, cli]
----
lun modify -vserver vserver_name -volume volume_name -lun lun_name -state offline
----
. 启用空间分配：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -space-allocation enabled
----
. 验证是否已启用空间分配：
+
[source, cli]
----
lun show -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -fields space-allocation
----
. 使 LUN 联机：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -state online
----
. 在主机上、重新扫描所有磁盘、以确保对所做的更改 `-space-allocation` 已正确发现选项。


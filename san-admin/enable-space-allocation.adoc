---
permalink: san-admin/enable-space-allocation.html 
sidebar: sidebar 
keywords: enable, space allocation, space reclamation, unmap 
summary: 如果将 space-allocation 选项设置为 enabled ，则当卷空间用尽且卷中的 LUN 无法接受写入时， ONTAP 会通知主机。此选项还允许 ONTAP 在主机删除数据时自动回收空间。 
---
= 为SAN启用空间分配
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果FC或iSCSI主机支持SCSI精简配置、则可以启用空间分配。  启用空间分配后、如果卷用尽空间、则该卷中的LUN将保持联机并设置为只读模式。  然后、系统会通知主机LUN无法再接受写入。  如果主机不支持或未启用空间分配、则当卷用尽空间且无法自动增长时、ONTAP会使LUN脱机。

此外、如果启用了空间分配、则主机端空间管理功能会识别已在主机文件系统上删除的数据块、并自动发出一个或多个数据块 `SCSI UNMAP` 用于释放存储系统上的相应块并允许ONTAP回收空间的命令。

.开始之前
要启用空间分配、主机必须支持SCSI精简配置。SCSI精简配置使用SCSI SBC-3标准中定义的逻辑块配置。只有支持此标准的主机才能在 ONTAP 中使用 SCSI 精简配置。

启用空间分配时，以下主机当前支持 SCSI 精简配置：

* Citrix XenServer 6.5 及更高版本
* ESXi 5.0及更高版本
* Oracle Linux 6.2 UEK内核及更高版本
* Red Hat Enterprise Linux 6.2 及更高版本
* SUSE Linux Enterprise Server 11及更高版本
* Solaris 11.1及更高版本
* Windows


NVMe主机不支持空间分配。

.关于此任务
从ONTAP 9.151开始、新创建的VMware和Hyper-V LUN会默认启用空间分配、而所有新创建的LUN不会由VMware和Hyper-V使用、则会禁用空间分配


NOTE: 将集群升级到ONTAP 9.151后、无论主机类型如何、在软件升级之前创建的所有LUN的空间分配设置在升级后均保持不变。  例如、如果在ONTAP 9.13.1中为禁用了空间分配的VMware主机创建了LUN、则在升级到ONTAP 9.15.1后、该LUN上的空间分配仍会处于禁用状态。

要启用空间分配、必须使LUN脱机；然后、必须在主机上执行发现、主机才能识别已启用空间分配。

.步骤
. 使 LUN 脱机：
+
[source, cli]
----
lun modify -vserver vserver_name -volume volume_name -lun lun_name -state offline
----
. 启用空间分配：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -space-allocation enabled
----
. 验证是否已启用空间分配：
+
[source, cli]
----
lun show -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -fields space-allocation
----
. 使 LUN 联机：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -state online
----
. 在主机上、重新扫描所有磁盘、以确保对所做的更改 `-space-allocation` 已正确发现选项。

